# 编译阶段
FROM node:18-alpine AS build
ENV TZ="Asia/Shanghai"

WORKDIR /app
COPY . .

# 使用 Yarn 安装项目依赖
RUN yarn install

# 构建项目
RUN yarn build

# 运行阶段
FROM node:18-alpine AS run

WORKDIR /app

# 从编译阶段复制构建好的文件，而不包含开发依赖
COPY --from=build /app/dist /app/dist
COPY --from=build /app/node_modules /app/node_modules
COPY --from=build /app/server /app/server
COPY package.json yarn.lock ./

EXPOSE 3200

CMD ["yarn", "run", "start"]
